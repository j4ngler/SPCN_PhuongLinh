{% extends "base.html" %}

{% block title %}Dashboard - {{ student_id }}{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>üìä Dashboard H·ªçc t·∫≠p - {{ student_id }}</h1>
    
    {% if generated_student_id %}
    <div class="alert success">
        üéâ H·ªá th·ªëng ƒë√£ t·∫°o m√£ h·ªçc sinh <strong>{{ generated_student_id }}</strong> cho b·∫°n v√† sinh d·ªØ li·ªáu demo. B·∫°n c√≥ th·ªÉ nh·∫≠p th√™m ƒëi·ªÉm ·ªü m·ª•c ‚ÄúNh·∫≠p d·ªØ li·ªáu‚Äù.
    </div>
    {% endif %}
    
    {% if profile %}
    <div class="profile-section">
        <h2>üë§ Th√¥ng tin H·ªçc sinh</h2>
        <div class="profile-card">
            <p><strong>H·ªç t√™n:</strong> {{ profile.get('name', 'N/A') }}</p>
            <p><strong>Ng√†nh:</strong> {{ profile.get('major', 'N/A') }}</p>
            <p><strong>ƒê·ªãnh h∆∞·ªõng:</strong> {{ profile.get('career_path', 'N/A') }}</p>
            <p><strong>Phong c√°ch h·ªçc:</strong> {{ profile.get('learning_style', 'N/A') }}</p>
            {% if profile.get('interests') %}
            <p><strong>S·ªü th√≠ch:</strong> {{ profile.get('interests', 'N/A') }}</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    {% if stats %}
    <div class="stats-section">
        <h2>üìà Th·ªëng k√™ T·ªïng quan</h2>
        <div class="stats-grid">
            {% if stats.avg_ai_score %}
            <div class="stat-card">
                <h3>AI Score Trung b√¨nh</h3>
                <p class="stat-value">{{ (stats.avg_ai_score * 100)|round(1) }}%</p>
            </div>
            {% endif %}
            {% if stats.avg_grade %}
            <div class="stat-card">
                <h3>ƒêi·ªÉm Trung b√¨nh</h3>
                <p class="stat-value">{{ stats.avg_grade|round(2) }}</p>
            </div>
            {% endif %}
            {% if stats.total_subjects %}
            <div class="stat-card">
                <h3>T·ªïng s·ªë M√¥n h·ªçc</h3>
                <p class="stat-value">{{ stats.total_subjects }}</p>
            </div>
            {% endif %}
            {% if stats.max_ai_score %}
            <div class="stat-card">
                <h3>AI Score Cao nh·∫•t</h3>
                <p class="stat-value">{{ (stats.max_ai_score * 100)|round(1) }}%</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if weekly_subject_load %}
    <div class="stats-section">
        <h2>üìÖ Tu·∫ßn n√†y c·ªßa b·∫°n (trong tr∆∞·ªùng)</h2>
        <p class="small-text">
            D·ª±a tr√™n s·ªë bu·ªïi/tu·∫ßn cho t·ª´ng m√¥n v√† AI Score hi·ªán t·∫°i,
            h·ªá th·ªëng g·ª£i √Ω m·ª©c ƒë·ªô ∆∞u ti√™n t·∫≠p trung tr√™n l·ªõp.
        </p>
        <div class="stats-grid">
            {% for item in weekly_subject_load %}
            <div class="stat-card">
                <h3>{{ item.subject_name or item.subject_code }}</h3>
                <p class="stat-value">{{ item.lessons_per_week }} bu·ªïi/tu·∫ßn</p>
                {% if item.ai_score is not none %}
                    {% set score_val = item.ai_score %}
                    <p>
                        AI Score: {{ (score_val * 100)|round(1) }}%
                        {% if score_val < 0.4 %}
                            <span class="badge-low">ƒêang v·∫•t v·∫£ - c·∫ßn t·∫≠p trung</span>
                        {% elif score_val < 0.7 %}
                            <span class="badge-medium">Trung b√¨nh - n√™n ch√∫ √Ω h∆°n</span>
                        {% else %}
                            <span class="badge-good">Kh√° ·ªïn - ti·∫øp t·ª•c duy tr√¨</span>
                        {% endif %}
                    </p>
                {% else %}
                    <p class="small-text">Ch∆∞a c√≥ AI Score cho m√¥n n√†y</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if recommendations %}
    <div class="recommendations-section">
        <h2>üéØ G·ª£i √Ω H·ªçc t·∫≠p</h2>
        <div class="recommendations-grid">
            {% for rec in recommendations[:10] %}
            <div class="recommendation-card">
                <h3>{{ rec.subject_name }}</h3>
                <p class="subject-code">{{ rec.subject_code }}</p>
                <div class="score-bar">
                    <div class="score-fill" style="width: {{ rec.ai_score * 100 }}%"></div>
                    <span class="score-text">{{ (rec.ai_score * 100)|round(1) }}%</span>
                </div>
                <p class="reason">{{ rec.reason }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if scores %}
    <div class="scores-section">
        <h2>üìà AI Scores theo M√¥n h·ªçc</h2>
        <table class="scores-table">
            <thead>
                <tr>
                    <th>M√£ m√¥n</th>
                    <th>T√™n m√¥n</th>
                    <th>AI Score</th>
                    <th>ƒê√°nh gi√°</th>
                </tr>
            </thead>
            <tbody>
                {% for score in scores|sort(attribute='ai_score', reverse=True) %}
                <tr>
                    <td>{{ score.get('subject_code', 'N/A') }}</td>
                    <td>{{ score.get('subject_name', 'N/A') }}</td>
                    <td>
                        <span class="score-badge">{{ (score.get('ai_score', 0) * 100)|round(1) }}%</span>
                    </td>
                    <td>
                        {% set score_val = score.get('ai_score', 0) %}
                        {% if score_val >= 0.8 %}
                            <span class="badge-excellent">Xu·∫•t s·∫Øc</span>
                        {% elif score_val >= 0.6 %}
                            <span class="badge-good">T·ªët</span>
                        {% elif score_val >= 0.4 %}
                            <span class="badge-medium">Trung b√¨nh</span>
                        {% else %}
                            <span class="badge-low">C·∫ßn c·∫£i thi·ªán</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    {% if grades %}
    <div class="grades-section">
        <h2>üìù ƒêi·ªÉm s·ªë Th·ª±c t·∫ø</h2>
        <table class="scores-table">
            <thead>
                <tr>
                    <th>M√£ m√¥n</th>
                    <th>ƒêi·ªÉm s·ªë</th>
                    <th>T·ª∑ l·ªá tham gia</th>
                    <th>Ho√†n th√†nh b√†i t·∫≠p</th>
                    <th>H·ªçc k·ª≥</th>
                </tr>
            </thead>
            <tbody>
                {% for grade in grades %}
                <tr>
                    <td>{{ grade.get('subject_code', 'N/A') }}</td>
                    <td><strong>{{ grade.get('grade_score', 'N/A') }}</strong></td>
                    <td>{{ (grade.get('attendance_rate', 0) * 100)|round(1) }}%</td>
                    <td>{{ (grade.get('homework_completion', 0) * 100)|round(1) }}%</td>
                    <td>{{ grade.get('semester', 'N/A') }} - {{ grade.get('year', 'N/A') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    {% if not scores and not recommendations and not profile %}
    <div class="no-data">
        <p>‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu cho h·ªçc sinh n√†y.</p>
        <p>Vui l√≤ng ch·∫°y pipeline ƒë·ªÉ t·∫°o d·ªØ li·ªáu ho·∫∑c ki·ªÉm tra l·∫°i m√£ h·ªçc sinh.</p>
        <a href="{{ url_for('manage') }}" class="btn">ƒêi ƒë·∫øn trang Qu·∫£n l√Ω</a>
    </div>
    {% endif %}
</div>
{% endblock %}

